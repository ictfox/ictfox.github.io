<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="ceph,radosgw," />










<meta name="description" content="概述本文针对对象存储OSS的基本功能，提供能测试的方法和脚本一些基于boto3API的简单操作示例：boto3API.py 1234567891011121314151617181920212223242526272829303132333435363738394041424344#!/usr/bin/env python#-*- coding:utf-8 -*-import boto3# cre">
<meta name="keywords" content="ceph,radosgw">
<meta property="og:type" content="article">
<meta property="og:title" content="对象存储OSS功能测试">
<meta property="og:url" content="http://www.yangguanjun.com/2016/12/15/rgw-functions-tst/index.html">
<meta property="og:site_name" content="ictfox blog">
<meta property="og:description" content="概述本文针对对象存储OSS的基本功能，提供能测试的方法和脚本一些基于boto3API的简单操作示例：boto3API.py 1234567891011121314151617181920212223242526272829303132333435363738394041424344#!/usr/bin/env python#-*- coding:utf-8 -*-import boto3# cre">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2018-04-04T02:10:00.355Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="对象存储OSS功能测试">
<meta name="twitter:description" content="概述本文针对对象存储OSS的基本功能，提供能测试的方法和脚本一些基于boto3API的简单操作示例：boto3API.py 1234567891011121314151617181920212223242526272829303132333435363738394041424344#!/usr/bin/env python#-*- coding:utf-8 -*-import boto3# cre">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.yangguanjun.com/2016/12/15/rgw-functions-tst/"/>





  <title>对象存储OSS功能测试 | ictfox blog</title>
  








  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-7472013512056838",
    enable_page_level_ads: true
  });
</script>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ictfox blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">ForTech</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.yangguanjun.com/2016/12/15/rgw-functions-tst/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ictfox">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/ictfox.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ictfox blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">对象存储OSS功能测试</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-15T15:11:17+08:00">
                2016-12-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ceph/" itemprop="url" rel="index">
                    <span itemprop="name">ceph</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/12/15/rgw-functions-tst/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/12/15/rgw-functions-tst/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>本文针对对象存储OSS的基本功能，提供能测试的方法和脚本<br>一些基于boto3API的简单操作示例：boto3API.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> boto3</span><br><span class="line"></span><br><span class="line"><span class="comment"># creating a client</span></span><br><span class="line">s3client = boto3.client(<span class="string">'s3'</span>,</span><br><span class="line">                        aws_secret_access_key = <span class="string">'ZSU2I***8aNgGyMHBFhqwWnRzKz1fO'</span>,</span><br><span class="line">                        aws_access_key_id = <span class="string">'C6Y1E0C3EB***W8YIKEW'</span>,</span><br><span class="line">                        endpoint_url = <span class="string">'http://10.1.0.29'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># creating a bucket</span></span><br><span class="line">bucket_name = <span class="string">'ictfox'</span></span><br><span class="line">response = s3client.create_bucket(Bucket = bucket_name)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"Creating bucket &#123;0&#125; returns =&gt; &#123;1&#125;\n"</span>.format(bucket_name, response)</span><br><span class="line"></span><br><span class="line"><span class="comment"># listing owned buckets</span></span><br><span class="line">response = s3client.list_buckets()</span><br><span class="line"><span class="keyword">for</span> bucket <span class="keyword">in</span> response[<span class="string">'Buckets'</span>]:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"Listing owned buckets returns =&gt; &#123;0&#125; was created on &#123;1&#125;\n"</span>.format(bucket[<span class="string">'Name'</span>], bucket[<span class="string">'CreationDate'</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># creating an object</span></span><br><span class="line">object_key = <span class="string">'hello.txt'</span></span><br><span class="line">response = s3client.put_object(Bucket = bucket_name, Key = object_key, Body = <span class="string">'Hello World!'</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"Creating object &#123;0&#125; returns =&gt; &#123;1&#125;\n"</span>.format(object_key, response)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Listing a bucket's content</span></span><br><span class="line">response = s3client.list_objects(Bucket = bucket_name)</span><br><span class="line"><span class="keyword">for</span> obj <span class="keyword">in</span> response[<span class="string">'Contents'</span>]:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"Listing a bucket's content returns =&gt; &#123;0&#125;\t&#123;1&#125;\t&#123;2&#125;\n"</span>.format(obj[<span class="string">'Key'</span>], obj[<span class="string">'Size'</span>], obj[<span class="string">'LastModified'</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Changing an object's metadata(head object)</span></span><br><span class="line">metadata = &#123;<span class="string">'x-amz-meta-datastore'</span>: <span class="string">'qr'</span>, <span class="string">'x-amz-meta-datastore-version'</span>: <span class="string">'1.0.1'</span>&#125;</span><br><span class="line">copySrc = <span class="string">'&#123;0&#125;/&#123;1&#125;'</span>.format(bucket_name, object_key)</span><br><span class="line">response = s3client.copy_object(Bucket = bucket_name, CopySource = copySrc, Key = object_key, Metadata = metadata, MetadataDirective = <span class="string">'REPLACE'</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"Changing metadata of object &#123;0&#125; returns =&gt; &#123;1&#125;\n"</span>.format(object_key, response)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Deleting an object</span></span><br><span class="line">response = s3client.delete_object(Bucket = bucket_name, Key = object_key)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"Deleting object &#123;0&#125; returns =&gt; &#123;1&#125;\n"</span>.format(object_key, response)</span><br><span class="line"></span><br><span class="line"><span class="comment"># deleting a bucket</span></span><br><span class="line">response = s3client.delete_bucket(Bucket = bucket_name)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"Deleting bucket &#123;0&#125; returns =&gt; &#123;1&#125;\n"</span>.format(bucket_name, response)</span><br></pre></td></tr></table></figure>
<h2 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h2><p>用户的管理是通过Admin Ops API提供；这里我们通过之前创建好的管理账户来执行Admin Ops API，具体可以参考：<a href="http://docs.ceph.com/docs/master/radosgw/adminops/" target="_blank" rel="noopener">http://docs.ceph.com/docs/master/radosgw/adminops/</a></p>
<h3 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ cat usercreate.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">token=5L65QDE4df8JJ8RM7MN5 <span class="comment">## USER_TOKEN</span></span><br><span class="line">secret=Y9HPiBCwLDeSMSaiQhmPT2h7NgNUndvLERhktnIZ <span class="comment">## USER_SECRET</span></span><br><span class="line">query=<span class="variable">$1</span></span><br><span class="line">name=<span class="variable">$2</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$query</span>, <span class="variable">$name</span></span><br><span class="line">query3=<span class="string">"&amp;uid="</span></span><br><span class="line">query2=admin/user</span><br><span class="line">date=$(<span class="keyword">for</span> i <span class="keyword">in</span> $(date <span class="string">"+%H"</span>) ; <span class="keyword">do</span> date <span class="string">"+%a, %d %b %Y <span class="variable">$(( 10#$i-8 )</span>):%M:%S +0000"</span> ; <span class="keyword">done</span>)</span><br><span class="line">header=<span class="string">"PUT\n\n\n<span class="variable">$&#123;date&#125;</span>\n/<span class="variable">$&#123;query2&#125;</span>"</span></span><br><span class="line">sig=$(<span class="built_in">echo</span> -en <span class="variable">$&#123;header&#125;</span> | openssl sha1 -hmac <span class="variable">$&#123;secret&#125;</span> -binary | base64)</span><br><span class="line">curl -v -H <span class="string">"Date: <span class="variable">$&#123;date&#125;</span>"</span> -H <span class="string">"Authorization: AWS <span class="variable">$&#123;token&#125;</span>:<span class="variable">$&#123;sig&#125;</span>"</span> -L -X PUT <span class="string">"http://&lt;your-host-ip&gt;/<span class="variable">$&#123;query2&#125;</span>?format=json<span class="variable">$&#123;query3&#125;</span><span class="variable">$&#123;query&#125;</span>&amp;display-name=<span class="variable">$&#123;name&#125;</span>"</span> -H <span class="string">"Host: &lt;your-host-ip&gt;"</span></span><br></pre></td></tr></table></figure>
<h3 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ cat userdelete.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">token=5L65QDE4238JJ8RM7MN5 <span class="comment">## USER_TOKEN</span></span><br><span class="line">secret=Y9HPiBCwLDeSMSaiQhmPT2h7NgNUnqVLERhktnIZ <span class="comment">## USER_SECRET</span></span><br><span class="line">query=<span class="variable">$1</span></span><br><span class="line">query3=<span class="string">"&amp;uid="</span></span><br><span class="line">query2=admin/user</span><br><span class="line">date=$(<span class="keyword">for</span> i <span class="keyword">in</span> $(date <span class="string">"+%H"</span>) ; <span class="keyword">do</span> date <span class="string">"+%a, %d %b %Y <span class="variable">$(( 10#$i-8 )</span>):%M:%S +0000"</span> ; <span class="keyword">done</span>)</span><br><span class="line">header=<span class="string">"DELETE\n\n\n<span class="variable">$&#123;date&#125;</span>\n/<span class="variable">$&#123;query2&#125;</span>"</span></span><br><span class="line">sig=$(<span class="built_in">echo</span> -en <span class="variable">$&#123;header&#125;</span> | openssl sha1 -hmac <span class="variable">$&#123;secret&#125;</span> -binary | base64)</span><br><span class="line">curl -v -H <span class="string">"Date: <span class="variable">$&#123;date&#125;</span>"</span> -H <span class="string">"Authorization: AWS <span class="variable">$&#123;token&#125;</span>:<span class="variable">$&#123;sig&#125;</span>"</span> -L -X DELETE <span class="string">"http://&lt;your-host-ip&gt;/<span class="variable">$&#123;query2&#125;</span>?format=json<span class="variable">$&#123;query3&#125;</span><span class="variable">$&#123;query&#125;</span>"</span> -H <span class="string">"Host: &lt;your-host-ip&gt;"</span></span><br></pre></td></tr></table></figure>
<h2 id="User-keys"><a href="#User-keys" class="headerlink" title="User keys"></a>User keys</h2><p>管理User的keys也是通过admin Ops API操作的，同样需要通过管理账户来执行；</p>
<h3 id="创建user-key"><a href="#创建user-key" class="headerlink" title="创建user key"></a>创建user key</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$cat</span> createKey.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">token=5L65QDE4238JJ8RM7MN5 <span class="comment">## USER_TOKEN</span></span><br><span class="line">secret=Y9HPiBCwLDeSMSaiQhmPT2h7NgNUnqVLERhktnIZ <span class="comment">## USER_SECRET</span></span><br><span class="line">operate=<span class="string">"PUT"</span></span><br><span class="line">user=<span class="variable">$1</span></span><br><span class="line">query=<span class="string">"admin/user"</span></span><br><span class="line">date=$(<span class="keyword">for</span> i <span class="keyword">in</span> $(date <span class="string">"+%H"</span>) ; <span class="keyword">do</span> date <span class="string">"+%a, %d %b %Y <span class="variable">$(( 10#$i-8 )</span>):%M:%S +0000"</span> ; <span class="keyword">done</span>)</span><br><span class="line">header=<span class="string">"<span class="variable">$&#123;operate&#125;</span>\n\n\n<span class="variable">$&#123;date&#125;</span>\n/<span class="variable">$&#123;query&#125;</span>"</span></span><br><span class="line">sig=$(<span class="built_in">echo</span> -en <span class="variable">$&#123;header&#125;</span> | openssl sha1 -hmac <span class="variable">$&#123;secret&#125;</span> -binary | base64)</span><br><span class="line">curl -v -L -X <span class="variable">$&#123;operate&#125;</span> <span class="string">"http://&lt;your-host-ip&gt;/<span class="variable">$&#123;query&#125;</span>?key&amp;format=json&amp;uid=<span class="variable">$&#123;user&#125;</span>&amp;generate-key=True"</span> \</span><br><span class="line"> -H <span class="string">"Date: <span class="variable">$&#123;date&#125;</span>"</span> \</span><br><span class="line"> -H <span class="string">"Authorization: AWS <span class="variable">$&#123;token&#125;</span>:<span class="variable">$&#123;sig&#125;</span>"</span> \</span><br><span class="line"> -H <span class="string">"Host: &lt;your-host-ip&gt;"</span></span><br></pre></td></tr></table></figure>
<h3 id="删除user-key"><a href="#删除user-key" class="headerlink" title="删除user key"></a>删除user key</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cat removeKey.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">token=5L65QDE4238JJ8RM7MN5 <span class="comment">## USER_TOKEN</span></span><br><span class="line">secret=Y9HPiBCwLDeSMSaiQhmPT2h7NgNUnqVLERhktnIZ <span class="comment">## USER_SECRET</span></span><br><span class="line">operate=<span class="string">"DELETE"</span></span><br><span class="line">key=<span class="variable">$1</span></span><br><span class="line">query=<span class="string">"admin/user"</span></span><br><span class="line">date=$(<span class="keyword">for</span> i <span class="keyword">in</span> $(date <span class="string">"+%H"</span>) ; <span class="keyword">do</span> date <span class="string">"+%a, %d %b %Y <span class="variable">$(( 10#$i-8 )</span>):%M:%S +0000"</span> ; <span class="keyword">done</span>)</span><br><span class="line">header=<span class="string">"<span class="variable">$&#123;operate&#125;</span>\n\n\n<span class="variable">$&#123;date&#125;</span>\n/<span class="variable">$&#123;query&#125;</span>"</span></span><br><span class="line">sig=$(<span class="built_in">echo</span> -en <span class="variable">$&#123;header&#125;</span> | openssl sha1 -hmac <span class="variable">$&#123;secret&#125;</span> -binary | base64)</span><br><span class="line">curl -v -L -X <span class="variable">$&#123;operate&#125;</span> <span class="string">"http://&lt;your-host-ip&gt;/<span class="variable">$&#123;query&#125;</span>?key&amp;format=json&amp;access-key=<span class="variable">$&#123;key&#125;</span>"</span> \</span><br><span class="line">           -H <span class="string">"Date: <span class="variable">$&#123;date&#125;</span>"</span> \</span><br><span class="line">           -H <span class="string">"Authorization: AWS <span class="variable">$&#123;token&#125;</span>:<span class="variable">$&#123;sig&#125;</span>"</span> \</span><br><span class="line">           -H <span class="string">"Host: &lt;your-host-ip&gt;"</span></span><br></pre></td></tr></table></figure>
<h3 id="列出user-keys"><a href="#列出user-keys" class="headerlink" title="列出user keys"></a>列出user keys</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cat getUserInfo.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">token=5L65QDE4238JJ8RM7MN5 <span class="comment">## USER_TOKEN</span></span><br><span class="line">secret=Y9HPiBCwLDeSMSaiQhmPT2h7NgNUnqVLERhktnIZ <span class="comment">## USER_SECRET</span></span><br><span class="line">user=<span class="variable">$1</span></span><br><span class="line">query=admin/user</span><br><span class="line">date=$(<span class="keyword">for</span> i <span class="keyword">in</span> $(date <span class="string">"+%H"</span>) ; <span class="keyword">do</span> date <span class="string">"+%a, %d %b %Y <span class="variable">$(( 10#$i-8 )</span>):%M:%S +0000"</span> ; <span class="keyword">done</span>)</span><br><span class="line">header=<span class="string">"GET\n\n\n<span class="variable">$&#123;date&#125;</span>\n/<span class="variable">$&#123;query&#125;</span>"</span></span><br><span class="line">sig=$(<span class="built_in">echo</span> -en <span class="variable">$&#123;header&#125;</span> | openssl sha1 -hmac <span class="variable">$&#123;secret&#125;</span> -binary | base64)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$sig</span></span><br><span class="line">curl -v -L -X GET <span class="string">"http://&lt;your-host-ip&gt;/<span class="variable">$&#123;query&#125;</span>?format=json&amp;uid=<span class="variable">$&#123;user&#125;</span>"</span> \</span><br><span class="line">           -H <span class="string">"Date: <span class="variable">$&#123;date&#125;</span>"</span> \</span><br><span class="line">           -H <span class="string">"Authorization: AWS <span class="variable">$&#123;token&#125;</span>:<span class="variable">$&#123;sig&#125;</span>"</span> \</span><br><span class="line">           -H <span class="string">"Host: &lt;your-host-ip&gt;"</span></span><br></pre></td></tr></table></figure>
<h2 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h2><p>开源的比较常用的s3的SDK有boto3，我们在RDS的备份中已经使用过<br>参考：<a href="http://boto3.readthedocs.io/en/latest/reference/services/s3.html#s3" target="_blank" rel="noopener">http://boto3.readthedocs.io/en/latest/reference/services/s3.html#s3</a></p>
<p><strong>下面的操作都简要列出了调用的api和说明；</strong></p>
<h3 id="获取Bucket权限"><a href="#获取Bucket权限" class="headerlink" title="获取Bucket权限"></a>获取Bucket权限</h3><p>get_bucket_acl(**kwargs)  </p>
<ul>
<li>Gets the access control policy for the bucket.</li>
</ul>
<h3 id="设置Bucket权限"><a href="#设置Bucket权限" class="headerlink" title="设置Bucket权限"></a>设置Bucket权限</h3><p>put_bucket_acl(**kwargs)  </p>
<ul>
<li>Sets the permissions on a bucket using access control lists (ACL).</li>
</ul>
<h2 id="Bucket操作"><a href="#Bucket操作" class="headerlink" title="Bucket操作"></a>Bucket操作</h2><p>同权限管理，下面的操作基于boto3，都简要列出了调用的api和说明；</p>
<h3 id="列出Buckets"><a href="#列出Buckets" class="headerlink" title="列出Buckets"></a>列出Buckets</h3><p>list_buckets()  </p>
<ul>
<li>Returns a list of all buckets owned by the authenticated sender of the request.</li>
</ul>
<h3 id="创建Bucket"><a href="#创建Bucket" class="headerlink" title="创建Bucket"></a>创建Bucket</h3><p>create_bucket(**kwargs)  </p>
<ul>
<li>Creates a new bucket.</li>
</ul>
<h3 id="删除Bucket"><a href="#删除Bucket" class="headerlink" title="删除Bucket"></a>删除Bucket</h3><p>delete_bucket(**kwargs)  </p>
<ul>
<li>Deletes the bucket. All objects (including all object versions and Delete Markers) in the bucket must be deleted before the bucket itself can be deleted.</li>
</ul>
<h3 id="列出Bucket-Objects"><a href="#列出Bucket-Objects" class="headerlink" title="列出Bucket Objects"></a>列出Bucket Objects</h3><ol>
<li><p>list_objects(**kwargs)<br> Returns some or all (up to 1000) of the objects in a bucket. You can use the request parameters as selection criteria to return a subset of the objects in a bucket.</p>
</li>
<li><p>list_objects_v2(**kwargs)<br> Returns some or all (up to 1000) of the objects in a bucket. You can use the request parameters as selection criteria to return a subset of the objects in a bucket. Note: ListObjectsV2 is the revised List Objects API and we recommend you use this revised API for new application development.</p>
</li>
</ol>
<h3 id="获取Bucket-ACL"><a href="#获取Bucket-ACL" class="headerlink" title="获取Bucket ACL"></a>获取Bucket ACL</h3><p>get_bucket_acl(**kwargs)  </p>
<ul>
<li>Gets the access control policy for the bucket.</li>
</ul>
<h3 id="设置Bucket-ACL"><a href="#设置Bucket-ACL" class="headerlink" title="设置Bucket ACL"></a>设置Bucket ACL</h3><p>put_bucket_acl(**kwargs)  </p>
<ul>
<li>Sets the permissions on a bucket using access control lists (ACL).</li>
</ul>
<h3 id="获取Bucket-Info"><a href="#获取Bucket-Info" class="headerlink" title="获取Bucket Info"></a>获取Bucket Info</h3><p>head_bucket(**kwargs)  </p>
<ul>
<li>This operation is useful to determine if a bucket exists and you have permission to access it.</li>
</ul>
<h3 id="枚举Bucket分块上传"><a href="#枚举Bucket分块上传" class="headerlink" title="枚举Bucket分块上传"></a>枚举Bucket分块上传</h3><p>list_multipart_uploads(**kwargs)  </p>
<ul>
<li>This operation lists in-progress multipart uploads.</li>
</ul>
<h2 id="Object操作"><a href="#Object操作" class="headerlink" title="Object操作"></a>Object操作</h2><h3 id="上传Object"><a href="#上传Object" class="headerlink" title="上传Object"></a>上传Object</h3><ol>
<li><p>put_object(**kwargs)<br> Adds an object to a bucket.</p>
</li>
<li><p>upload_file(Filename, Bucket, Key, ExtraArgs=None, Callback=None, Config=None)<br> Upload a file to an S3 object.</p>
</li>
<li><p>upload_fileobj(Fileobj, Bucket, Key, ExtraArgs=None, Callback=None, Config=None)<br> Upload a file-like object to S3.<br> The file-like object must be in binary mode.<br> This is a managed transfer which will perform a multipart upload in multiple threads if necessary.</p>
</li>
</ol>
<h3 id="复制Object"><a href="#复制Object" class="headerlink" title="复制Object"></a>复制Object</h3><p>copy_object(**kwargs)  </p>
<ul>
<li>Creates a copy of an object that is already stored in Amazon S3.</li>
</ul>
<h3 id="删除Object"><a href="#删除Object" class="headerlink" title="删除Object"></a>删除Object</h3><ol>
<li><p>delete_object(**kwargs)<br> Removes the null version (if there is one) of an object and inserts a delete marker, which becomes the latest version of the object. If there isn’t a null version, Amazon S3 does not remove any objects.</p>
</li>
<li><p>delete_objects(**kwargs)<br> This operation enables you to delete multiple objects from a bucket using a single HTTP request. You may specify up to 1000 keys.</p>
</li>
</ol>
<h3 id="下载Object"><a href="#下载Object" class="headerlink" title="下载Object"></a>下载Object</h3><ol>
<li><p>get_object(**kwargs)<br> Retrieves objects from Amazon S3.</p>
</li>
<li><p>download_file(Bucket, Key, Filename, ExtraArgs=None, Callback=None, Config=None)<br> Download an S3 object to a file.</p>
</li>
<li><p>download_fileobj(Bucket, Key, Fileobj, ExtraArgs=None, Callback=None, Config=None)<br> Download an object from S3 to a file-like object.<br> The file-like object must be in binary mode.<br> This is a managed transfer which will perform a multipart download in multiple threads if necessary.</p>
</li>
</ol>
<h3 id="获取Object-ACL"><a href="#获取Object-ACL" class="headerlink" title="获取Object ACL"></a>获取Object ACL</h3><p>get_object_acl(**kwargs)  </p>
<ul>
<li>Returns the access control list (ACL) of an object.</li>
</ul>
<h3 id="设置Object-ACL"><a href="#设置Object-ACL" class="headerlink" title="设置Object ACL"></a>设置Object ACL</h3><p>put_object_acl(**kwargs)  </p>
<ul>
<li>uses the acl subresource to set the access control list (ACL) permissions for an object that already exists in a bucket</li>
</ul>
<h3 id="获取Object-Info"><a href="#获取Object-Info" class="headerlink" title="获取Object Info"></a>获取Object Info</h3><p>head_object(**kwargs)  </p>
<ul>
<li>The HEAD operation retrieves metadata from an object without returning the object itself. This operation is useful if you’re only interested in an object’s metadata. To use HEAD, you must have READ access to the object.</li>
</ul>
<h3 id="支持Object-Multipart"><a href="#支持Object-Multipart" class="headerlink" title="支持Object Multipart"></a>支持Object Multipart</h3><ol>
<li><p>create_multipart_upload(**kwargs)<br> Initiates a multipart upload and returns an upload ID.</p>
</li>
<li><p>complete_multipart_upload(**kwargs)<br> Completes a multipart upload by assembling previously uploaded parts.</p>
</li>
<li><p>abort_multipart_upload(**kwargs)<br> Aborts a multipart upload.<br> To verify that all parts have been removed, so you don’t get charged for the part storage, you should call the List Parts operation and ensure the parts list is empty.</p>
</li>
<li><p>upload_part(**kwargs)<br> Uploads a part in a multipart upload.</p>
</li>
</ol>
<h2 id="其他操作"><a href="#其他操作" class="headerlink" title="其他操作"></a>其他操作</h2><h3 id="获取RGW-User统计信息"><a href="#获取RGW-User统计信息" class="headerlink" title="获取RGW User统计信息"></a>获取RGW User统计信息</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ cat getUsage.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">token=5L65QDE4238JJ8RM7MN5 <span class="comment">## USER_TOKEN</span></span><br><span class="line">secret=Y9HPiBCwLDeSMSaiQhmPT2h7NgNUnqVLERhktnIZ <span class="comment">## USER_SECRET</span></span><br><span class="line">operate=<span class="string">"GET"</span></span><br><span class="line">user=<span class="variable">$1</span></span><br><span class="line">query=<span class="string">"admin/usage"</span></span><br><span class="line">date=$(<span class="keyword">for</span> i <span class="keyword">in</span> $(date <span class="string">"+%H"</span>) ; <span class="keyword">do</span> date <span class="string">"+%a, %d %b %Y <span class="variable">$(( 10#$i-8 )</span>):%M:%S +0000"</span> ; <span class="keyword">done</span>)</span><br><span class="line">header=<span class="string">"<span class="variable">$&#123;operate&#125;</span>\n\n\n<span class="variable">$&#123;date&#125;</span>\n/<span class="variable">$&#123;query&#125;</span>"</span></span><br><span class="line">sig=$(<span class="built_in">echo</span> -en <span class="variable">$&#123;header&#125;</span> | openssl sha1 -hmac <span class="variable">$&#123;secret&#125;</span> -binary | base64)</span><br><span class="line">curl -v -L -X <span class="variable">$&#123;operate&#125;</span> <span class="string">"http://&lt;your-host-ip&gt;/<span class="variable">$&#123;query&#125;</span>?format=json&amp;uid=<span class="variable">$&#123;user&#125;</span>"</span> \</span><br><span class="line">           -H <span class="string">"Date: <span class="variable">$&#123;date&#125;</span>"</span> \</span><br><span class="line">           -H <span class="string">"Authorization: AWS <span class="variable">$&#123;token&#125;</span>:<span class="variable">$&#123;sig&#125;</span>"</span> \</span><br><span class="line">           -H <span class="string">"Host: &lt;your-host-ip&gt;"</span></span><br></pre></td></tr></table></figure>
<h3 id="删除RGW-User统计信息"><a href="#删除RGW-User统计信息" class="headerlink" title="删除RGW User统计信息"></a>删除RGW User统计信息</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ cat trimeUsage.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">token=5L65QDE4238JJ8RM7MN5 <span class="comment">## USER_TOKEN</span></span><br><span class="line">secret=Y9HPiBCwLDeSMSaiQhmPT2h7NgNUnqVLERhktnIZ <span class="comment">## USER_SECRET</span></span><br><span class="line">operate=<span class="string">"DELETE"</span></span><br><span class="line">user=<span class="variable">$1</span></span><br><span class="line">stime=<span class="variable">$2</span> <span class="comment">#start time</span></span><br><span class="line">etime=<span class="variable">$3</span> <span class="comment">#end time</span></span><br><span class="line">query=<span class="string">"admin/usage"</span></span><br><span class="line">date=$(<span class="keyword">for</span> i <span class="keyword">in</span> $(date <span class="string">"+%H"</span>) ; <span class="keyword">do</span> date <span class="string">"+%a, %d %b %Y <span class="variable">$(( 10#$i-8 )</span>):%M:%S +0000"</span> ; <span class="keyword">done</span>)</span><br><span class="line">header=<span class="string">"<span class="variable">$&#123;operate&#125;</span>\n\n\n<span class="variable">$&#123;date&#125;</span>\n/<span class="variable">$&#123;query&#125;</span>"</span></span><br><span class="line">sig=$(<span class="built_in">echo</span> -en <span class="variable">$&#123;header&#125;</span> | openssl sha1 -hmac <span class="variable">$&#123;secret&#125;</span> -binary | base64)</span><br><span class="line">curl -v -L -X <span class="variable">$&#123;operate&#125;</span> <span class="string">"http://&lt;your-host-ip&gt;/<span class="variable">$&#123;query&#125;</span>?format=json&amp;uid=<span class="variable">$&#123;user&#125;</span>&amp;start=<span class="variable">$&#123;stime&#125;</span>&amp;end=<span class="variable">$&#123;etime&#125;</span>"</span> \</span><br><span class="line">           -H <span class="string">"Date: <span class="variable">$&#123;date&#125;</span>"</span> \</span><br><span class="line">           -H <span class="string">"Authorization: AWS <span class="variable">$&#123;token&#125;</span>:<span class="variable">$&#123;sig&#125;</span>"</span> \</span><br><span class="line">           -H <span class="string">"Host: &lt;your-host-ip&gt;"</span></span><br></pre></td></tr></table></figure>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>支持原创</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>红包</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="ictfox WeChat Pay"/>
        <p>WeChat Pay</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="ictfox Alipay"/>
        <p>Alipay</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/ceph/" rel="tag"># ceph</a>
          
            <a href="/tags/radosgw/" rel="tag"># radosgw</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/12/12/rgw-oss/" rel="next" title="RadosGW对象存储使用文档">
                <i class="fa fa-chevron-left"></i> RadosGW对象存储使用文档
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/02/22/rbd-data-replication/" rel="prev" title="ceph块存储跨机房灾备调研">
                ceph块存储跨机房灾备调研 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/ictfox.jpg"
                alt="ictfox" />
            
              <p class="site-author-name" itemprop="name">ictfox</p>
              <p class="site-description motion-element" itemprop="description">学无止境</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">92</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">61</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/ictfox" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://twitter.com/smart_bruins" target="_blank" title="Twitter">
                      
                        <i class="fa fa-fw fa-twitter"></i>Twitter</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://weibo.com/ictfox" target="_blank" title="Weibo">
                      
                        <i class="fa fa-fw fa-weibo"></i>Weibo</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.askceph.com" title="Ceph问答社区" target="_blank">Ceph问答社区</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://blog.csdn.net/for_tech" title="CSDN博客" target="_blank">CSDN博客</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#概述"><span class="nav-number">1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#用户管理"><span class="nav-number">2.</span> <span class="nav-text">用户管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建用户"><span class="nav-number">2.1.</span> <span class="nav-text">创建用户</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除用户"><span class="nav-number">2.2.</span> <span class="nav-text">删除用户</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#User-keys"><span class="nav-number">3.</span> <span class="nav-text">User keys</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建user-key"><span class="nav-number">3.1.</span> <span class="nav-text">创建user key</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除user-key"><span class="nav-number">3.2.</span> <span class="nav-text">删除user key</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#列出user-keys"><span class="nav-number">3.3.</span> <span class="nav-text">列出user keys</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#权限管理"><span class="nav-number">4.</span> <span class="nav-text">权限管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#获取Bucket权限"><span class="nav-number">4.1.</span> <span class="nav-text">获取Bucket权限</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设置Bucket权限"><span class="nav-number">4.2.</span> <span class="nav-text">设置Bucket权限</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Bucket操作"><span class="nav-number">5.</span> <span class="nav-text">Bucket操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#列出Buckets"><span class="nav-number">5.1.</span> <span class="nav-text">列出Buckets</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建Bucket"><span class="nav-number">5.2.</span> <span class="nav-text">创建Bucket</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除Bucket"><span class="nav-number">5.3.</span> <span class="nav-text">删除Bucket</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#列出Bucket-Objects"><span class="nav-number">5.4.</span> <span class="nav-text">列出Bucket Objects</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取Bucket-ACL"><span class="nav-number">5.5.</span> <span class="nav-text">获取Bucket ACL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设置Bucket-ACL"><span class="nav-number">5.6.</span> <span class="nav-text">设置Bucket ACL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取Bucket-Info"><span class="nav-number">5.7.</span> <span class="nav-text">获取Bucket Info</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#枚举Bucket分块上传"><span class="nav-number">5.8.</span> <span class="nav-text">枚举Bucket分块上传</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Object操作"><span class="nav-number">6.</span> <span class="nav-text">Object操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#上传Object"><span class="nav-number">6.1.</span> <span class="nav-text">上传Object</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#复制Object"><span class="nav-number">6.2.</span> <span class="nav-text">复制Object</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除Object"><span class="nav-number">6.3.</span> <span class="nav-text">删除Object</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#下载Object"><span class="nav-number">6.4.</span> <span class="nav-text">下载Object</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取Object-ACL"><span class="nav-number">6.5.</span> <span class="nav-text">获取Object ACL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设置Object-ACL"><span class="nav-number">6.6.</span> <span class="nav-text">设置Object ACL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取Object-Info"><span class="nav-number">6.7.</span> <span class="nav-text">获取Object Info</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#支持Object-Multipart"><span class="nav-number">6.8.</span> <span class="nav-text">支持Object Multipart</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其他操作"><span class="nav-number">7.</span> <span class="nav-text">其他操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#获取RGW-User统计信息"><span class="nav-number">7.1.</span> <span class="nav-text">获取RGW User统计信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除RGW-User统计信息"><span class="nav-number">7.2.</span> <span class="nav-text">删除RGW User统计信息</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ictfox</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://ictfox.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://www.yangguanjun.com/2016/12/15/rgw-functions-tst/';
          this.page.identifier = '2016/12/15/rgw-functions-tst/';
          this.page.title = '对象存储OSS功能测试';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://ictfox.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  














  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
